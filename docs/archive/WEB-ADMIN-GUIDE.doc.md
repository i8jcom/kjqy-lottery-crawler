# 🌐 Web管理界面使用指南

## 📌 访问方式

启动爬虫服务后，访问：

```
http://localhost:4000
```

**如果在远程服务器上部署**，访问：
```
http://你的服务器IP:4000
```

⚠️ **注意**：默认端口是4000，可以在 `.env` 文件中修改 `WEB_PORT` 配置。

---

## 🎨 功能说明

### 1. 系统状态仪表板

顶部显示4个核心指标：

```
┌─────────────────────────────────────────────────┐
│ 系统状态  │ 总爬取次数 │ 彩种总数 │ 数据源状态 │
│ 运行中 ✓  │   1234     │   40    │   1/1     │
│           │ 成功率:97% │ 8/20/12 │  健康/总数 │
└─────────────────────────────────────────────────┘
```

**说明**：
- **系统状态**: 爬虫是否正在运行
- **总爬取次数**: 自启动以来的总爬取次数和成功率
- **彩种总数**: 总共管理的彩种数（高频/中频/低频）
- **数据源状态**: 健康的数据源数量

### 2. 数据源状态

显示所有已配置的数据源健康状况：

```
┌────────────────────────────────┐
│ ✅ 3650098 (当前)              │
│ 成功率: 98.5%                  │
│ 总请求: 1234                   │
│ 连续失败: 0次                  │
└────────────────────────────────┘
```

**颜色说明**：
- **绿色边框**: 数据源健康
- **红色边框**: 数据源不健康（需要关注）

### 3. 最新爬取数据

显示最近爬取的前10个彩种的实时数据：

| 彩种 | 当前期号 | 开奖号码 | 开奖时间 | 倒计时 |
|------|---------|---------|---------|--------|
| 极速赛车 | 33846500 | 01,05,08,03,10... | 2025-12-21 14:30:15 | 45秒 |

**用途**：
- 快速验证爬虫是否正常工作
- 查看数据新鲜度

### 4. 彩种列表

完整的40个彩种列表，支持手动触发爬取：

| 彩种代码 | 彩种名称 | 开奖间隔 | 优先级 | 操作 |
|---------|---------|---------|--------|------|
| 10037 | 极速赛车 | 75秒 | high | [手动爬取] |

**优先级颜色**：
- <span style="color:red">**high**</span> - 红色（高频彩种）
- <span style="color:orange">**medium**</span> - 橙色（中频彩种）
- <span style="color:green">**low**</span> - 绿色（低频彩种）

**手动爬取**：
- 点击"手动爬取"按钮可立即触发该彩种的数据爬取
- 用于测试或临时补充数据

### 5. 系统日志

实时显示最近100条日志：

```
[2025-12-21 14:30:00] INFO: 📡 开始爬取: 极速赛车 (10037)
[2025-12-21 14:30:01] INFO: ✅ 爬取成功: 极速赛车 - 期号 33846500
```

**日志颜色**：
- <span style="color:#4fc3f7">**蓝色**</span> - INFO（信息）
- <span style="color:#81c784">**绿色**</span> - SUCCESS（成功）
- <span style="color:#ffb74d">**橙色**</span> - WARN（警告）
- <span style="color:#e57373">**红色**</span> - ERROR（错误）

**刷新日志**：
- 点击"刷新日志"按钮手动刷新
- 页面每30秒自动刷新一次

---

## 🔄 自动刷新

页面每**30秒**自动刷新一次所有数据，包括：
- 系统状态
- 数据源状态
- 最新爬取数据
- 日志

**最后更新时间**显示在页面底部。

---

## 🎯 常见使用场景

### 场景1：检查爬虫是否正常运行

1. 访问管理界面
2. 查看顶部"系统状态"是否为"运行中 ✓"
3. 查看"总爬取次数"是否在增加
4. 查看"最新爬取数据"是否有数据

### 场景2：测试单个彩种爬取

1. 滚动到"彩种列表"
2. 找到要测试的彩种
3. 点击"手动爬取"按钮
4. 等待3秒后刷新"最新爬取数据"查看结果

### 场景3：排查爬取失败

1. 查看"数据源状态"是否有红色边框（不健康）
2. 查看"系统日志"中的错误信息
3. 查看日志中是否有连续的失败记录

### 场景4：监控系统性能

1. 查看"总爬取次数"的成功率（建议>95%）
2. 查看"数据源状态"的成功率（建议>95%）
3. 查看日志中是否有频繁的警告或错误

---

## ⚙️ 配置说明

### 修改Web端口

编辑 `.env` 文件：

```bash
# 修改为其他端口（如5000）
WEB_PORT=5000
```

重启服务：
```bash
pm2 restart crawler-service
```

### 允许远程访问

默认情况下，Web界面监听所有网络接口（0.0.0.0），可以通过服务器IP访问。

**安全建议**：
- 生产环境建议使用Nginx反向代理
- 配置防火墙规则限制访问IP
- 或者使用SSH隧道访问

**使用SSH隧道**（推荐）：
```bash
# 本地终端执行
ssh -L 4000:localhost:4000 user@your-server-ip

# 然后访问
http://localhost:4000
```

---

## 🔐 安全说明

⚠️ **重要**：当前版本**没有身份认证**，任何能访问该端口的人都可以：
- 查看系统状态
- 查看日志
- 手动触发爬取

**建议**：
1. **开发环境**：直接使用，无需担心
2. **生产环境**：
   - 使用防火墙限制访问（只允许内网IP）
   - 或使用Nginx + 基础认证
   - 或使用SSH隧道访问

**Nginx基础认证示例**：
```nginx
server {
    listen 80;
    server_name your-domain.com;

    location / {
        auth_basic "Crawler Admin";
        auth_basic_user_file /etc/nginx/.htpasswd;
        proxy_pass http://localhost:4000;
    }
}
```

---

## 📱 移动端访问

管理界面支持响应式设计，可以在手机/平板上访问：

```
http://你的服务器IP:4000
```

建议添加到主屏幕，方便随时查看。

---

## 🐛 故障排查

### 问题1：无法访问管理界面

**检查**：
1. 爬虫服务是否正在运行？
   ```bash
   pm2 status
   ```

2. 端口是否被占用？
   ```bash
   netstat -tuln | grep 4000
   ```

3. 防火墙是否开放端口？
   ```bash
   # CentOS/RHEL
   firewall-cmd --list-ports

   # Ubuntu
   ufw status
   ```

### 问题2：数据不更新

**解决**：
1. 刷新浏览器页面（F5）
2. 清除浏览器缓存
3. 检查爬虫服务日志：
   ```bash
   pm2 logs crawler-service
   ```

### 问题3：手动爬取失败

**检查**：
1. 查看系统日志中的错误信息
2. 检查数据源状态是否健康
3. 检查网络连接

---

## 📊 API文档

如果需要通过API集成，可以直接调用以下端点：

### GET /api/status
获取系统状态

```bash
curl http://localhost:4000/api/status
```

### GET /api/lotteries
获取彩种列表

```bash
curl http://localhost:4000/api/lotteries
```

### GET /api/latest-data
获取最新数据

```bash
# 所有彩种
curl http://localhost:4000/api/latest-data

# 单个彩种
curl http://localhost:4000/api/latest-data?lotCode=10037
```

### POST /api/crawl
手动触发爬取

```bash
curl -X POST http://localhost:4000/api/crawl \
  -H "Content-Type: application/json" \
  -d '{"lotCode": "10037"}'
```

### GET /api/logs
获取日志

```bash
# 最近100条
curl http://localhost:4000/api/logs

# 最近50条
curl http://localhost:4000/api/logs?lines=50
```

---

## 🎉 总结

Web管理界面提供了：
- ✅ 实时系统状态监控
- ✅ 数据源健康检查
- ✅ 最新数据查看
- ✅ 手动爬取控制
- ✅ 系统日志查看
- ✅ 自动刷新（30秒）
- ✅ 移动端支持

**建议**：
- 开发调试时随时打开查看
- 生产环境定期检查系统状态
- 配合主系统监控使用

有问题随时查看日志！
