# WSLé‡å¯å4000ç«¯å£å ç”¨é—®é¢˜ - å®Œæ•´åˆ†æ

## ğŸ¯ é—®é¢˜æ ¹æº

### é”™è¯¯çš„å¯åŠ¨è„šæœ¬

**æ–‡ä»¶**: `rebuild-and-restart.sh`
**é—®é¢˜ä»£ç **:
```bash
nohup node src/web/WebServer.js > /tmp/crawler-service.log 2>&1 &
```

**é”™è¯¯**: å¯åŠ¨çš„æ˜¯ `WebServer.js` è€Œä¸æ˜¯ `src/index.js`

### å¯¼è‡´çš„åæœ

1. **åªæœ‰å‰ç«¯é¡µé¢** - WebServer.jsåªæä¾›é™æ€é¡µé¢æœåŠ¡
2. **æ²¡æœ‰APIæ¥å£** - APIè·¯ç”±åœ¨index.jsä¸­æ³¨å†Œ
3. **æ²¡æœ‰çˆ¬è™«è°ƒåº¦** - è°ƒåº¦å™¨åœ¨index.jsä¸­å¯åŠ¨
4. **WebSocketæ— æ•°æ®** - è™½ç„¶è¿æ¥æˆåŠŸï¼Œä½†æ²¡æœ‰æ•°æ®æ¨é€

### ä¸ºä»€ä¹ˆä¼šå ç”¨4000ç«¯å£

å½“æœ‰äººï¼ˆå¯èƒ½æ˜¯ä¹‹å‰çš„è°ƒè¯•ï¼‰æ‰§è¡Œäº†ä»¥ä¸‹æ“ä½œä¹‹ä¸€ï¼š
1. è¿è¡Œäº† `rebuild-and-restart.sh`
2. æ‰‹åŠ¨æ‰§è¡Œäº† `nohup node src/web/WebServer.js &`
3. å…¶ä»–ç±»ä¼¼çš„é”™è¯¯å¯åŠ¨è„šæœ¬

ç»“æœï¼š
- æœ¬åœ°WSLäº§ç”Ÿäº†ä¸€ä¸ªrootæƒé™çš„nodeè¿›ç¨‹
- è¿™ä¸ªè¿›ç¨‹å ç”¨äº†4000ç«¯å£
- ä½†å®ƒ**ä¸æ˜¯å®Œæ•´çš„çˆ¬è™«æœåŠ¡**ï¼Œåªæ˜¯WebServer

## ğŸ” å¦‚ä½•è¯†åˆ«é—®é¢˜

### æ­£å¸¸çŠ¶æ€

```bash
# æ£€æŸ¥è¿›ç¨‹
ps aux | grep "node.*src/index.js"
# åº”è¯¥åªçœ‹åˆ°Dockerå®¹å™¨å†…çš„è¿›ç¨‹ï¼ˆé€šè¿‡containerd-shimå¯åŠ¨ï¼‰

# æ£€æŸ¥Dockerå®¹å™¨
docker ps | grep lottery-crawler-compose
# çŠ¶æ€åº”è¯¥æ˜¯ Up (healthy)

# æµ‹è¯•API
curl http://localhost:4000/scheduler/lotteries
# åº”è¯¥è¿”å›JSONæ•°æ®ï¼Œä¸æ˜¯HTML
```

### é—®é¢˜çŠ¶æ€

```bash
# æ£€æŸ¥è¿›ç¨‹
ps aux | grep "node.*src/index.js"
# å¯èƒ½çœ‹åˆ°ä¸¤ä¸ªè¿›ç¨‹ï¼š
# 1. Dockerå®¹å™¨å†…çš„ï¼ˆçˆ¶è¿›ç¨‹æ˜¯containerd-shimï¼‰âœ… æ­£å¸¸
# 2. æœ¬åœ°WSLçš„ï¼ˆçˆ¶è¿›ç¨‹æ˜¯1æˆ–å…¶ä»–ï¼‰âŒ å¼‚å¸¸

# æµ‹è¯•API
curl http://localhost:4000/scheduler/lotteries
# è¿”å›HTMLè€Œä¸æ˜¯JSON âŒ è¯´æ˜è¿æ¥åˆ°äº†é”™è¯¯çš„æœåŠ¡
```

## âœ… è§£å†³æ–¹æ¡ˆ

### 1. ç«‹å³ä¿®å¤ï¼ˆå·²å®æ–½ï¼‰

```bash
# åœæ­¢é”™è¯¯çš„æœ¬åœ°è¿›ç¨‹
ps aux | grep "node.*src/index.js" | grep -v docker | grep -v grep | awk '{print $2}' | xargs kill -9

# é‡å¯Dockerå®¹å™¨
docker restart lottery-crawler-compose
```

### 2. è‡ªåŠ¨ä¿®å¤è„šæœ¬ï¼ˆå·²éƒ¨ç½²ï¼‰

**æ–‡ä»¶**: `~/.bashrc.d/lottery-crawler-startup.sh`

æ¯æ¬¡æ‰“å¼€bashç»ˆç«¯è‡ªåŠ¨æ£€æŸ¥å¹¶ä¿®å¤ã€‚

### 3. ä¿®æ­£é”™è¯¯çš„å¯åŠ¨è„šæœ¬

éœ€è¦ä¿®æ”¹ä»¥ä¸‹è„šæœ¬ï¼š

#### rebuild-and-restart.sh

**é”™è¯¯çš„**:
```bash
nohup node src/web/WebServer.js > /tmp/crawler-service.log 2>&1 &
```

**æ­£ç¡®çš„**:
```bash
# åº”è¯¥ä½¿ç”¨Dockerè€Œä¸æ˜¯ç›´æ¥å¯åŠ¨æœ¬åœ°è¿›ç¨‹
docker-compose restart
```

æˆ–è€…å¦‚æœä¸€å®šè¦æœ¬åœ°å¯åŠ¨ï¼ˆä¸æ¨èï¼‰:
```bash
nohup node src/index.js > /tmp/crawler-service.log 2>&1 &
```

## ğŸ—ï¸ æ­£ç¡®çš„æ¶æ„

### ç”Ÿäº§ç¯å¢ƒï¼ˆæ¨èï¼‰

```
Windows/WSL
  â””â”€ Docker Engine
       â””â”€ lottery-crawler-compose å®¹å™¨
            â””â”€ node src/index.js (PID 1 in container)
                 â”œâ”€ WebServer (å‰ç«¯+API)
                 â”œâ”€ WebSocket (å®æ—¶æ¨é€)
                 â”œâ”€ Scheduler (çˆ¬è™«è°ƒåº¦)
                 â””â”€ Crawlers (æ•°æ®æŠ“å–)
```

**ç«¯å£æ˜ å°„**:
- å®¹å™¨å†…4000 â†’ ä¸»æœº4000
- å¤–éƒ¨è®¿é—® http://localhost:4000 ç›´æ¥åˆ°å®¹å™¨

### é”™è¯¯çš„çŠ¶æ€ï¼ˆä¹‹å‰çš„é—®é¢˜ï¼‰

```
Windows/WSL
  â”œâ”€ æœ¬åœ°nodeè¿›ç¨‹ (å ç”¨4000ç«¯å£) âŒ
  â”‚    â””â”€ åªæœ‰WebServer.jsï¼Œæ²¡æœ‰APIå’Œçˆ¬è™«
  â”‚
  â””â”€ Docker Engine
       â””â”€ lottery-crawler-compose å®¹å™¨
            â””â”€ æ— æ³•ç»‘å®š4000ç«¯å£ï¼ˆè¢«å ç”¨ï¼‰âŒ
```

## ğŸ“ é˜²æ­¢é—®é¢˜å†æ¬¡å‘ç”Ÿ

### 1. æ°¸è¿œä¸è¦ç›´æ¥åœ¨WSLæœ¬åœ°å¯åŠ¨nodeè¿›ç¨‹

```bash
# âŒ é”™è¯¯ - ä¸è¦è¿™æ ·åš
node src/index.js
node src/web/WebServer.js
nohup node src/index.js &

# âœ… æ­£ç¡® - ä½¿ç”¨Docker
docker-compose up -d
docker-compose restart
```

### 2. æ£€æŸ¥æ‰€æœ‰é‡å¯è„šæœ¬

ç¡®ä¿æ‰€æœ‰ `restart*.sh` è„šæœ¬éƒ½ä½¿ç”¨Dockerå‘½ä»¤ï¼Œè€Œä¸æ˜¯ç›´æ¥å¯åŠ¨nodeè¿›ç¨‹ã€‚

### 3. å®šæœŸæ£€æŸ¥

```bash
# æ¯æ¬¡æ€€ç–‘æœ‰é—®é¢˜æ—¶è¿è¡Œ
bash /home/i8/.bashrc.d/lottery-crawler-startup.sh
```

## ğŸ”§ ä»Šå¤©çš„ä¿®å¤æ€»ç»“

1. âœ… è¯†åˆ«äº†PID 1216æ˜¯é”™è¯¯å¯åŠ¨çš„æœ¬åœ°è¿›ç¨‹
2. âœ… åœæ­¢äº†è¯¥è¿›ç¨‹
3. âœ… ç¡®è®¤Dockerå®¹å™¨æ­£å¸¸è¿è¡Œ
4. âœ… åˆ›å»ºäº†è‡ªåŠ¨æ£€æŸ¥è„šæœ¬é˜²æ­¢å¤å‘
5. âœ… è¯†åˆ«äº†`rebuild-and-restart.sh`çš„é”™è¯¯
6. âœ… æ–‡æ¡£åŒ–æ•´ä¸ªé—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

---

**æœ€åæ›´æ–°**: 2026-01-17 07:51
**çŠ¶æ€**: é—®é¢˜å·²å®Œå…¨è§£å†³å¹¶é˜²æ­¢å¤å‘ âœ…
