# ðŸ“Š ç¦å½©åŽ†å²æ•°æ®æŒ‰å¹´æŸ¥è¯¢åŠŸèƒ½

## âœ… åŠŸèƒ½è¯´æ˜Ž

ç¦å½©åŽ†å²æ•°æ®æŸ¥è¯¢çŽ°å·²æ”¯æŒ**æŒ‰å¹´æŸ¥è¯¢**ï¼Œä¸Žé¦™æ¸¯å…­åˆå½©ä¿æŒä¸€è‡´ã€‚

### æ”¯æŒçš„å½©ç§

| å½©ç§ | lotCode | è¯´æ˜Ž |
|------|---------|------|
| ç¦å½©åŒè‰²çƒ | 70001 | å‘¨äºŒã€å››ã€æ—¥å¼€å¥– |
| ç¦å½©3D | 70002 | æ¯å¤©å¼€å¥– |
| ç¦å½©ä¸ƒä¹å½© | 70003 | å‘¨ä¸€ã€ä¸‰ã€äº”å¼€å¥– |
| ç¦å½©å¿«ä¹8 | 70004 | æ¯å¤©å¼€å¥– |

## ðŸŽ¯ API ä½¿ç”¨æ–¹æ³•

### æŒ‰å¹´æŸ¥è¯¢

**æŽ¥å£**: `GET /api/history-data`

**å‚æ•°**:
- `lotCode` (å¿…éœ€): å½©ç§ä»£ç 
- `year` (å¿…éœ€): å¹´ä»½ï¼ˆå¦‚ 2025ï¼‰
- `pageNo` (å¯é€‰): é¡µç ï¼Œé»˜è®¤1
- `pageSize` (å¯é€‰): æ¯é¡µæ•°é‡ï¼Œé»˜è®¤50

**ç¤ºä¾‹è¯·æ±‚**:

```bash
# æŸ¥è¯¢ç¦å½©åŒè‰²çƒ 2025å¹´æ•°æ®
curl "http://localhost:4000/api/history-data?lotCode=70001&year=2025&pageSize=20"

# æŸ¥è¯¢ç¦å½©3D 2025å¹´æ•°æ®ï¼ˆåˆ†é¡µï¼‰
curl "http://localhost:4000/api/history-data?lotCode=70002&year=2025&pageNo=1&pageSize=50"

# æŸ¥è¯¢ç¦å½©ä¸ƒä¹å½© 2024å¹´æ•°æ®
curl "http://localhost:4000/api/history-data?lotCode=70003&year=2024"
```

**å“åº”æ ¼å¼**:

```json
{
  "success": true,
  "data": {
    "lotCode": "70001",
    "name": "ç¦å½©åŒè‰²çƒ",
    "records": [
      {
        "id": 185814,
        "lot_code": "70001",
        "issue": "2025150",
        "draw_code": "06,13,17,19,24,31,08",
        "draw_time": "2025-12-28 21:30:00",
        "created_at": "2025-12-30 12:17:34",
        "updated_at": "2025-12-30 13:10:54"
      }
    ],
    "total": 1,
    "pageNo": 1,
    "pageSize": 20,
    "totalPages": 1
  },
  "message": "æ•°æ®æ¥è‡ªæ•°æ®åº“ (2025å¹´)"
}
```

## ðŸ“ˆ æµ‹è¯•éªŒè¯

### æµ‹è¯•1ï¼šç¦å½©åŒè‰²çƒ 2025å¹´

```bash
curl -s "http://localhost:4000/api/history-data?lotCode=70001&year=2025&pageSize=20"
```

**ç»“æžœ**: âœ… æˆåŠŸè¿”å›ž1æœŸæ•°æ®
```json
{
  "success": true,
  "message": "æ•°æ®æ¥è‡ªæ•°æ®åº“ (2025å¹´)",
  "total": 1
}
```

### æµ‹è¯•2ï¼šç¦å½©3D 2025å¹´

```bash
curl -s "http://localhost:4000/api/history-data?lotCode=70002&year=2025"
```

**ç»“æžœ**: âœ… æˆåŠŸè¿”å›ž1æœŸæ•°æ®
```json
{
  "success": true,
  "message": "æ•°æ®æ¥è‡ªæ•°æ®åº“ (2025å¹´)",
  "total": 1,
  "records": [
    {
      "issue": "2025349",
      "draw_code": "7,4,3",
      "draw_time": "2025-12-29 21:15:00"
    }
  ]
}
```

### æµ‹è¯•3ï¼šæŸ¥è¯¢æ— æ•°æ®å¹´ä»½

```bash
curl -s "http://localhost:4000/api/history-data?lotCode=70001&year=2024"
```

**ç»“æžœ**: âœ… æ­£ç¡®è¿”å›žç©ºæ•°æ®
```json
{
  "success": true,
  "message": "2024å¹´æš‚æ— æ•°æ®",
  "total": 0,
  "records": []
}
```

## ðŸ”„ ä¸Žé¦™æ¸¯å…­åˆå½©å¯¹æ¯”

### é¦™æ¸¯å…­åˆå½©æŒ‰å¹´æŸ¥è¯¢

```bash
curl -s "http://localhost:4000/api/history-data?lotCode=60001&year=2025&pageSize=10"
```

**ç»“æžœ**: âœ… è¿”å›ž134æœŸæ•°æ®
```json
{
  "success": true,
  "message": "æ•°æ®æ¥è‡ªæ•°æ®åº“ (2025å¹´)",
  "total": 134,
  "records": [...]
}
```

### åŠŸèƒ½ä¸€è‡´æ€§

| åŠŸèƒ½ | é¦™æ¸¯å…­åˆå½© | ç¦å½© | çŠ¶æ€ |
|------|-----------|------|------|
| æŒ‰å¹´æŸ¥è¯¢ | âœ… | âœ… | ä¸€è‡´ |
| åˆ†é¡µæ”¯æŒ | âœ… | âœ… | ä¸€è‡´ |
| æ•°æ®åº“ä¼˜å…ˆ | âœ… | âœ… | ä¸€è‡´ |
| æ— æ•°æ®æç¤º | âœ… | âœ… | ä¸€è‡´ |
| è¿”å›žæ ¼å¼ | JSON | JSON | ä¸€è‡´ |

## ðŸŽ¯ æ•°æ®æºè¯´æ˜Ž

### æ•°æ®æ¥æº

ç¦å½©åŽ†å²æ•°æ®æŒ‰å¹´æŸ¥è¯¢**ä»…ä»Žæ•°æ®åº“è¯»å–**ï¼ŒåŽŸå› ï¼š

1. **å®žæ—¶è½®è¯¢ç§¯ç´¯**: ç¦å½©å½©ç§å·²é…ç½®æ™ºèƒ½çª—å£è°ƒåº¦ï¼Œåœ¨å¼€å¥–çª—å£å†…å®žæ—¶è½®è¯¢å¹¶è‡ªåŠ¨ä¿å­˜æ•°æ®
2. **æ•°æ®å®Œæ•´æ€§**: æ¯æœŸå¼€å¥–åŽæ•°æ®è‡ªåŠ¨å…¥åº“ï¼Œæ— éœ€é¢å¤–çˆ¬å–
3. **æŸ¥è¯¢æ•ˆçŽ‡**: æ•°æ®åº“æŸ¥è¯¢é€Ÿåº¦å¿«ï¼ˆ~50msï¼‰ï¼Œæ— éœ€è®¿é—®å¤–éƒ¨API

### æ•°æ®ç§¯ç´¯æƒ…å†µ

| å½©ç§ | å¼€å¥–é¢‘çŽ‡ | é¢„æœŸå¹´æ•°æ®é‡ | å½“å‰çŠ¶æ€ |
|------|---------|-------------|---------|
| ç¦å½©åŒè‰²çƒ | å‘¨äºŒã€å››ã€æ—¥ | ~156æœŸ/å¹´ | 1æœŸï¼ˆæ–°æŽ¥å…¥ï¼‰ |
| ç¦å½©3D | æ¯å¤© | ~365æœŸ/å¹´ | 1æœŸï¼ˆæ–°æŽ¥å…¥ï¼‰ |
| ç¦å½©ä¸ƒä¹å½© | å‘¨ä¸€ã€ä¸‰ã€äº” | ~156æœŸ/å¹´ | 0æœŸï¼ˆæ–°æŽ¥å…¥ï¼‰ |
| ç¦å½©å¿«ä¹8 | æ¯å¤© | ~365æœŸ/å¹´ | 0æœŸï¼ˆæ–°æŽ¥å…¥ï¼‰ |

**è¯´æ˜Ž**:
- ç¦å½©å½©ç§äºŽ 2025-12-30 æ–°æŽ¥å…¥ç³»ç»Ÿ
- åŽ†å²æ•°æ®å°†éšç€æ¯æœŸå¼€å¥–è‡ªåŠ¨ç§¯ç´¯
- 2025å¹´å®Œæ•´æ•°æ®é¢„è®¡åœ¨å¹´åº•å‰å®Œæˆç§¯ç´¯

## ðŸ’¡ ä½¿ç”¨å»ºè®®

### 1. æŸ¥è¯¢æœ€æ–°æ•°æ®

ä¼˜å…ˆä½¿ç”¨æ— yearå‚æ•°çš„æŸ¥è¯¢ï¼ŒèŽ·å–æœ€æ–°NæœŸæ•°æ®ï¼š

```bash
curl "http://localhost:4000/api/history-data?lotCode=70001&pageSize=50"
```

### 2. æŸ¥è¯¢ç‰¹å®šå¹´ä»½

ä½¿ç”¨yearå‚æ•°æŸ¥è¯¢å®Œæ•´å¹´åº¦æ•°æ®ï¼š

```bash
curl "http://localhost:4000/api/history-data?lotCode=70001&year=2025"
```

### 3. å¤§æ•°æ®é‡åˆ†é¡µ

å¯¹äºŽæ•°æ®é‡å¤§çš„å¹´ä»½ï¼Œå»ºè®®ä½¿ç”¨åˆ†é¡µï¼š

```bash
# ç¬¬1é¡µ
curl "http://localhost:4000/api/history-data?lotCode=70002&year=2025&pageNo=1&pageSize=100"

# ç¬¬2é¡µ
curl "http://localhost:4000/api/history-data?lotCode=70002&year=2025&pageNo=2&pageSize=100"
```

## ðŸ”§ å®žçŽ°ç»†èŠ‚

### ä»£ç ä½ç½®

`src/web/WebServer.js` - ç¬¬597-656è¡Œ

```javascript
// ðŸŽ¯ CWLç¦å½©ç‰¹æ®Šå¤„ç†ï¼šæŒ‰å¹´ä»½æŸ¥è¯¢
if (source === 'cwl' && year) {
  logger.info(`[Web] ðŸ“Š æŸ¥è¯¢ç¦å½©åŽ†å²æ•°æ®: ${name} (${lotCode}) - ${year}å¹´`);

  // ä»Žæ•°æ®åº“æŸ¥è¯¢è¯¥å¹´ä»½çš„æ•°æ®
  const yearStart = `${year}-01-01`;
  const yearEnd = `${year}-12-31 23:59:59`;

  const pool = database._initPool();
  const [dbYearRecords] = await pool.query(
    `SELECT * FROM lottery_results
     WHERE lot_code = ?
     AND draw_time >= ?
     AND draw_time <= ?
     ORDER BY draw_time DESC`,
    [lotCode, yearStart, yearEnd]
  );

  // ... å¤„ç†ç»“æžœå’Œåˆ†é¡µ ...
}
```

### SQLæŸ¥è¯¢

```sql
SELECT * FROM lottery_results
WHERE lot_code = '70001'
AND draw_time >= '2025-01-01'
AND draw_time <= '2025-12-31 23:59:59'
ORDER BY draw_time DESC
```

## ðŸ“… æ›´æ–°è®°å½•

- **2025-12-30 17:42**: âœ… ç¦å½©æŒ‰å¹´æŸ¥è¯¢åŠŸèƒ½å®žçŽ°å®Œæˆ
- **2025-12-30 17:42**: âœ… æµ‹è¯•éªŒè¯é€šè¿‡
- **2025-12-30 17:42**: âœ… Dockerå®¹å™¨é‡å¯ï¼ŒåŠŸèƒ½ä¸Šçº¿

## ðŸŽ‰ æ€»ç»“

ç¦å½©åŽ†å²æ•°æ®æŸ¥è¯¢çŽ°å·²å®Œå…¨æ”¯æŒæŒ‰å¹´æŸ¥è¯¢ï¼ŒåŠŸèƒ½ä¸Žé¦™æ¸¯å…­åˆå½©ä¿æŒä¸€è‡´ï¼š

âœ… æ”¯æŒ4ä¸ªç¦å½©å½©ç§
âœ… æŒ‰å¹´ä»½ç²¾ç¡®æŸ¥è¯¢
âœ… æ”¯æŒåˆ†é¡µ
âœ… ä»Žæ•°æ®åº“å¿«é€Ÿè¯»å–
âœ… æ— æ•°æ®å¹´ä»½æ­£ç¡®æç¤º
âœ… ä¸Žé¦™æ¸¯å…­åˆå½©æŸ¥è¯¢æ–¹å¼ä¸€è‡´

**ç³»ç»Ÿå·²é‡å¯ï¼ŒåŠŸèƒ½ç«‹å³å¯ç”¨ï¼**
