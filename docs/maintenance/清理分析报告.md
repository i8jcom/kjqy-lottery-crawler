# crawler-service 目录清理分析报告

生成时间: 2026-01-17 08:00

## 总体评估

当前 crawler-service 目录存在大量历史文件、测试脚本、文档和日志文件，需要系统性清理。

## 一、可以安全删除的文件

### 1.1 调试用文本和截图文件（根目录）

**删除理由**: 临时调试文件，无长期保留价值

```bash
./01.txt          # 70K  - 日志分析临时文件
./11.txt          # 1.5K - 临时文本
./88.txt          # 2.4K - 临时文本
./cc.txt          # 12K  - 临时文本
./11.png          # 169K - 调试截图
./47.png          # 61K  - 调试截图
```

**删除命令**:
```bash
rm -f ./01.txt ./11.txt ./88.txt ./cc.txt ./11.png ./47.png
```

### 1.2 一次性数据填充脚本（根目录）

**删除理由**: 历史数据修复任务已完成，不再需要

```bash
./backfill-taiwan-bingo-all.js     # 2.3K - 台湾宾果历史数据补全
./backfill-taiwan-bingo.js         # 1.4K - 台湾宾果补全
./backfill-taiwan39m5.js           # 2.7K - 台湾39选5补全
./fill-taiwan39m5-via-api.js       # 3.3K - API方式补全
./quick-fill-taiwan39m5.js         # 1.6K - 快速补全
./refill-taiwan49m6.js             # 2.7K - 台湾49选6重填
```

**删除命令**:
```bash
rm -f ./backfill-*.js ./fill-*.js ./quick-fill-*.js ./refill-*.js
```

### 1.3 一次性修复脚本（根目录）

**删除理由**: 特定bug修复任务已完成

```bash
./fix-all-hkjc-periods.js         # 2.7K - 修复香港赛马期号
./fix-domains.js                  # 1.5K - 域名修复
./fix-hkjc-period.js              # 2.7K - 修复单个赛马期号
./fix-latest-49m6.js              # 2.1K - 修复最新49选6数据
```

**删除命令**:
```bash
rm -f ./fix-*.js
```

### 1.4 临时测试脚本（根目录）

**删除理由**: 调试和验证用，非持续集成测试

```bash
./quick-test.js                   # 3.7K - 快速测试
./deep_test_plan_a.js             # 24K  - 深度测试计划A
./test-db-query.js                # 1.5K - 数据库查询测试
./test-deep-analysis.js           # 16K  - 深度分析测试
./test-import-sample.js           # 4.1K - 导入样本测试
./test-parse-html.js              # 2.2K - HTML解析测试
# ... 以及其他40多个 test-*.js 文件
```

**删除命令**:
```bash
rm -f ./test-*.js ./deep_test_plan_a.js
```

### 1.5 历史重启脚本（根目录）

**删除理由**: 特定问题修复后的重启脚本，已不需要

```bash
./restart-countdown-optimize.sh          # 1.4K - 倒计时优化重启
./restart-drawtime-sync-fix.sh           # 1.6K - 开奖时间同步修复
./restart-for-draw-time-fix.sh           # 1.3K - 开奖时间修复
./restart-number-update-fix.sh           # 1.5K - 号码更新修复
./restart-taiwan-50s-fix.sh              # 1.8K - 台湾50秒修复
./restart-taiwan-countdown-fix.sh        # 1.6K - 台湾倒计时修复
./restart-taiwan-countdown-stable.sh     # 2.0K - 台湾倒计时稳定版
./restart-taiwan-fast-poll.sh            # 1.6K - 台湾快速轮询
./restart-taiwan-final-fix.sh            # 2.1K - 台湾最终修复
./restart-websocket-countdown-fix.sh     # 1.4K - WebSocket倒计时修复
```

**保留**:
```bash
./restart.sh                      # 基础重启脚本 - 保留
./restart-server.sh               # 服务器重启 - 保留
./restart-service.sh              # 服务重启 - 保留
./restart_service.sh              # 下划线版本（检查是否重复）
```

**删除命令**:
```bash
rm -f ./restart-countdown-*.sh ./restart-drawtime-*.sh ./restart-for-*.sh \
      ./restart-number-*.sh ./restart-taiwan-*.sh ./restart-websocket-*.sh
```

### 1.6 其他临时脚本（根目录）

```bash
./backup-fix.sh                   # 556  - 备份修复（一次性）
./hkjc-reminder.sh                # 2.6K - 赛马提醒（已废弃）
./monitor-bingo.sh                # 710  - 宾果监控（临时）
./run-fetch-history.sh            # 175  - 历史数据拉取（临时）
./run-full-year.sh                # 165  - 全年数据（一次性）
./trigger-taiwan39m5-crawl.sh     # 1.3K - 手动触发爬取（测试用）
./trigger-taiwan49m6-crawl.sh     # 1.3K - 手动触发爬取（测试用）
./test_domain_management_ui.sh    # 3.5K - UI测试
./test_speedy_endpoints.sh        # 3.4K - 端点测试
./test_update_timing.sh           # 2.0K - 时间测试
```

**删除命令**:
```bash
rm -f ./backup-fix.sh ./hkjc-reminder.sh ./monitor-bingo.sh \
      ./run-fetch-history.sh ./run-full-year.sh ./trigger-*.sh ./test_*.sh
```

### 1.7 旧日志文件（logs/ 目录）

**当前状态**: 198M 总大小，包含历史轮转日志

**删除理由**: 保留最新日志即可，历史日志已无价值

```bash
logs/crawler13.log - crawler17.log    # 日期13-17的历史日志
logs/crawler29.log - crawler33.log    # 日期29-33的历史日志
logs/crawler59.log - crawler63.log    # 日期59-63的历史日志
logs/error1.log                        # 旧错误日志
```

**保留**:
```bash
logs/crawler.log                   # 当前运行日志
logs/crawler-startup.log           # 启动日志
logs/crawler-full.log              # 完整日志
logs/error.log                     # 当前错误日志
```

**删除命令**:
```bash
rm -f logs/crawler[0-9]*.log logs/error[0-9]*.log
```

**预计节省空间**: ~180M

### 1.8 嵌套的重复目录（src/web/vue-app/）

**严重问题**: vue-app内部错误嵌套了整个项目副本

```bash
src/web/vue-app/claude-demo/                           # 76K  - 完全不应该存在
src/web/vue-app/claude-demo/kjqy-deploy/crawler-service/  # 嵌套的crawler-service
src/web/vue-app/crawler-service/                       # 116K - 重复的crawler-service
```

**删除理由**:
- vue-app是前端应用目录，不应包含项目根目录副本
- 这些是错误的目录结构，可能是操作失误导致

**删除命令**:
```bash
rm -rf src/web/vue-app/claude-demo
rm -rf src/web/vue-app/crawler-service
```

**预计节省空间**: ~192K

## 二、需要审查的文件

### 2.1 保留但可归档的验证脚本

这些脚本用于验证部署和集成，建议移动到 `scripts/verification/` 目录：

```bash
./verify-deployment.sh            # 3.3K - 部署验证
./verify-dual-source.sh           # 3.7K - 双数据源验证
./verify-hkjc-integration.sh      # 3.3K - 赛马集成验证
./stress-test-websocket.js        # 15K  - WebSocket压力测试
./test-suite.js                   # 6.4K - 测试套件
```

**建议操作**:
```bash
mkdir -p scripts/verification
mv ./verify-*.sh ./stress-test-*.js ./test-suite.js scripts/verification/
```

### 2.2 81个文档文件（*.doc.md）

**当前状态**: 分散在根目录，缺乏组织

**建议操作**:
1. 创建统一的文档目录结构
2. 按类型分类文档
3. 删除过时或重复的文档

**文档分类建议**:

```bash
docs/
├── deployment/          # 部署相关
│   ├── 1PANEL_DEPLOY.doc.md
│   ├── DEPLOYMENT-GUIDE.doc.md
│   ├── DEPLOYMENT-STATUS.doc.md
│   └── DEPLOYMENT_CHECKLIST.doc.md
├── fixes/               # 修复记录
│   ├── FIXES-2026-01-02.doc.md
│   ├── FIXES-2026-01-02-LUCKYSSCAI.doc.md
│   └── EMERGENCY_FIX.doc.md
├── reports/             # 分析报告
│   ├── ALERT-SYSTEM-OPTIMIZATION-REPORT.doc.md
│   ├── AUTO-CRAWL-VERIFICATION-REPORT.doc.md
│   └── CRASH_RISK_ANALYSIS.doc.md
└── guides/              # 开发指南
    ├── DEVELOPER-GUIDE.doc.md
    ├── DATABASE_CONFIG.doc.md
    └── DOMAIN_MANAGEMENT_UI.doc.md
```

**需要人工审查确认**哪些文档应该:
- 保留并归档
- 合并到统一文档
- 直接删除（过时内容）

## 三、必须保留的文件

### 3.1 核心启动脚本

```bash
./start.sh                        # 基础启动脚本
./restart.sh                      # 基础重启脚本
./restart-server.sh               # 服务器重启
./restart-service.sh              # 服务重启
```

**注意**: `rebuild-and-restart.sh` 包含**错误命令**，需要修复而非删除

### 3.2 活跃测试脚本

```bash
./test-all-sources-history.js     # 全数据源历史测试
./test-countdown-schedule.js      # 倒计时调度测试
./test-dual-source.js             # 双数据源测试
./test-schedule-optimization.js   # 调度优化测试
./test-sportslottery-health.js    # 健康检查测试
```

### 3.3 核心目录

```bash
src/                              # 源代码
config/                           # 配置文件
data/                             # 数据文件
logs/                             # 日志（清理后保留）
node_modules/                     # 依赖
```

## 四、清理执行计划

### 阶段1: 安全删除（立即执行）

```bash
# 1. 删除临时文件
rm -f ./01.txt ./11.txt ./88.txt ./cc.txt ./11.png ./47.png

# 2. 删除数据填充脚本
rm -f ./backfill-*.js ./fill-*.js ./quick-fill-*.js ./refill-*.js

# 3. 删除修复脚本
rm -f ./fix-*.js

# 4. 删除临时测试脚本
rm -f ./test-*.js ./deep_test_plan_a.js

# 5. 删除历史重启脚本
rm -f ./restart-countdown-*.sh ./restart-drawtime-*.sh \
      ./restart-for-*.sh ./restart-number-*.sh \
      ./restart-taiwan-*.sh ./restart-websocket-*.sh

# 6. 删除其他临时脚本
rm -f ./backup-fix.sh ./hkjc-reminder.sh ./monitor-bingo.sh \
      ./run-fetch-history.sh ./run-full-year.sh \
      ./trigger-*.sh ./test_*.sh

# 7. 删除嵌套重复目录
rm -rf src/web/vue-app/claude-demo
rm -rf src/web/vue-app/crawler-service

# 8. 清理旧日志
rm -f logs/crawler[0-9]*.log logs/error[0-9]*.log
```

### 阶段2: 整理归档

```bash
# 1. 创建验证脚本目录
mkdir -p scripts/verification
mv ./verify-*.sh ./stress-test-*.js ./test-suite.js scripts/verification/

# 2. 整理文档（需要人工审查后执行）
# mkdir -p docs/{deployment,fixes,reports,guides}
# mv *.doc.md docs/（按分类移动）
```

### 阶段3: 修复问题脚本

```bash
# rebuild-and-restart.sh 需要修复启动命令
# 从: nohup node src/web/WebServer.js > /tmp/crawler-service.log 2>&1 &
# 改为: docker-compose restart
```

## 五、清理效果预估

- **删除文件数量**: 约 100+ 个文件
- **节省磁盘空间**: 约 180-200 MB（主要是日志）
- **目录结构**: 从杂乱无序变为清晰有序
- **维护性**: 显著提升，易于定位核心文件

## 六、风险评估

- **风险等级**: 低
- **原因**:
  - 删除的都是临时、测试、历史文件
  - 核心源代码和配置不受影响
  - 可以从备份恢复（如果需要）

## 七、建议

1. **立即执行阶段1**的清理操作
2. **审查文档文件**后执行阶段2的归档
3. **修复 rebuild-and-restart.sh** 避免再次出现端口占用问题
4. **建立文件管理规范**:
   - 测试脚本统一放在 `scripts/tests/`
   - 临时调试文件不提交到仓库
   - 日志文件定期轮转和清理
   - 文档集中在 `docs/` 目录管理

---

**报告生成者**: Claude Code
**最后更新**: 2026-01-17 08:00
