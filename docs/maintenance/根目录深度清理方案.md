# crawler-service 根目录深度清理方案

生成时间: 2026-01-17 08:12

## 当前状态总结

**根目录文件总数**: 179个文件/目录
**需要清理**: 约120个文件
**应保留**: 约30个核心文件 + 目录

## 详细文件清单

### 一、可以安全删除的文件（约100个）

#### 1. 测试脚本 (29个) - 总计约80K

**HKJC相关测试** (7个):
```bash
test_hkjc_api_response.js           # 1.1K - 香港赛马API测试
test_hkjc_detection_step_by_step.js # 2.6K - 检测步骤测试
test_hkjc_sources.js                # 1.1K - 数据源测试
test_optimized_hkjc_detection.js    # 1.8K - 优化检测测试
check_hkjc_data.js                  # 2.2K - 数据检查
check_hkjc_official.js              # 837  - 官方数据检查
verify_hkjc_schedule.js             # 2.5K - 调度验证
```

**数据和时间相关测试** (8个):
```bash
test_date_format.js                 # 4.3K - 日期格式测试
test_date_formats.mjs               # 1.2K - 格式测试
test_date_pages.mjs                 # 2.9K - 日期页面测试
test_date_url.mjs                   # 1.3K - URL测试
test_timezone.js                    # 4.0K - 时区测试
test_timestamp_extraction.mjs       # 4.1K - 时间戳提取测试
check_next_day.mjs                  # 1.5K - 次日检查
check_data_detail.mjs               # 2.0K - 数据细节检查
```

**其他功能测试** (14个):
```bash
test_all_speedy_lotteries.js        # 8.1K - 极速彩测试
test_countdown_stability.py         # 2.7K - 倒计时稳定性
test_multisource.js                 # 2.1K - 多数据源测试
test_new_scraper.mjs                # 2.1K - 新爬虫测试
test_oncc_history_scraper.js        # 8.9K - ONCC历史爬取
test_optimized_refresh.py           # 1.8K - 优化刷新测试
test_plan_a.js                      # 7.3K - 方案A测试
test_refresh_timing.py              # 1.7K - 刷新时序测试
test_snowball_recognition.js        # 5.7K - 雪球识别测试
test_speedy_timing.js               # 3.4K - 极速彩时序测试
test_speedylot88.js                 # 911  - SpeedyLot88测试
check_scraper_order.mjs             # 592  - 爬虫顺序检查
debug_morning_data.mjs              # 3.9K - 早盘数据调试
debug_oncc_api.js                   # 4.9K - ONCC API调试
```

**删除命令**:
```bash
rm -f test_*.js test_*.mjs test_*.py
rm -f check_*.js check_*.mjs
rm -f debug_*.js debug_*.mjs
```

#### 2. 数据处理和验证脚本 (17个) - 总计约60K

**一次性数据处理** (5个):
```bash
fetch-cwl-history.js                # 4.0K - 拉取彩票历史
fetch-cwl-to-sql.js                 # 4.7K - 转SQL
fetch-full-year-data.js             # 7.4K - 全年数据
create-history-table.js             # 657  - 创建历史表
clean-duplicate-data.js             # 864  - 清理重复数据
补填台湾彩票历史数据.js              # 4.8K - 补填台湾数据
```

**临时检查脚本** (6个):
```bash
manual-save-morning.js              # 2.3K - 手动保存早盘
manual_check.mjs                    # 1.2K - 手动检查
verify-cpzhan-accuracy.js           # 3.6K - 验证准确性
verify-lottery.js                   # 5.9K - 彩票验证
verify_data.mjs                     # 4.3K - 数据验证
verify_after_restart.sh             # shell - 重启后验证
```

**数据分析脚本** (6个):
```bash
analyze_data_distribution.mjs       # 2.7K - 数据分布分析
compare_sources.mjs                 # 3.1K - 数据源对比
compare_with_reference.mjs          # 3.0K - 参考对比
check-domain.js                     # 1.2K - 域名检查
add-uklottos-domain.js              # 1.3K - 添加UK域名
quick-test.js                       # 3.7K - 快速测试
```

**删除命令**:
```bash
rm -f fetch-*.js
rm -f manual-*.js manual_*.mjs
rm -f verify-*.js verify_*.mjs verify_*.sh
rm -f clean-*.js
rm -f compare_*.mjs
rm -f analyze_*.mjs
rm -f add-*.js
rm -f check-*.js
rm -f quick-test.js
rm -f 补填台湾彩票历史数据.js
```

#### 3. 文档文件 (81个 .doc.md) - 需要整理归档

**部署相关** (15个):
```
1PANEL_DEPLOY.doc.md
DEPLOYMENT-GUIDE.doc.md
DEPLOYMENT-STATUS.doc.md
DEPLOYMENT.doc.md
DEPLOYMENT_CHECKLIST.doc.md
QUICKSTART-双数据源.doc.md
QUICKSTART.doc.md
QUICK_START.doc.md
README-dual-source.doc.md
RESTART-SERVICE.doc.md
RESTART_CHECKLIST.doc.md
RESTART_GUIDE.doc.md
RESTART_TO_SEE_TAIWAN_LOTTERY.doc.md
TAIWAN_LOTTERY_SETUP.doc.md
台湾彩票-最终修复报告.doc.md
```

**修复和优化报告** (30个):
```
ALERT-SYSTEM-OPTIMIZATION-REPORT.doc.md
AUTO-CRAWL-VERIFICATION-REPORT.doc.md
COMPACT_LAYOUT_OPTIMIZATION.doc.md
CONTROL_PANEL_REDESIGN.doc.md
CRASH_RISK_ANALYSIS.doc.md
EMERGENCY_FIX.doc.md
FIXES-2026-01-02-LUCKYSSCAI.doc.md
FIXES-2026-01-02.doc.md
FRONTEND-DATASOURCE-FIX.doc.md
FRONTEND-PERFORMANCE-OPTIMIZATION-REPORT.doc.md
HKJC-HOLIDAY-OPTIMIZATION.doc.md
HKJC-PERIOD-FIX.doc.md
HKJC-SMART-POLLING.doc.md
LATEST-DATA-FIX-REPORT.doc.md
OLD_LOGS_CLEANUP.doc.md
RESPONSIVE_LAYOUT_FIX.doc.md
SAVE-ALL-DATA-OPTIMIZATION.doc.md
SMART_LOG_FILTERING.doc.md
SPORTSLOTTERY_FIX_SUMMARY.doc.md
STAGE3_OPTIMIZATION_PROGRESS.doc.md
WEBSOCKET_PERFORMANCE_FIX.doc.md
WEEKDAY-DISPLAY-IMPLEMENTATION.doc.md
WEEKDAY-DISPLAY-VERIFICATION.doc.md
WEEKDAY-TIME-UPDATE-SUMMARY.doc.md
台湾宾果倒计时修复总结.doc.md
台湾彩票修复完成-API方案.doc.md
WebSocket监控页面改进.doc.md
香港六合彩告警修复总结.doc.md
极速彩WebSocket推送倒计时修复.md（已是.md）
极速彩倒计时归零修复方案.md（已是.md）
```

**功能实现文档** (20个):
```
AUTO-HISTORY-FETCH.doc.md
DATABASE_CONFIG.doc.md
DEVELOPER-GUIDE.doc.md
DOMAIN_MANAGEMENT_UI.doc.md
FULL-YEAR-DATA-GUIDE.doc.md
HISTORY-DATA-IMPORT.doc.md
HISTORY-YEAR-QUERY.doc.md
HKJC-API-抓包指南.doc.md
HKJC-DATASOURCE-SUMMARY.doc.md
HKJC-Integration-Report.doc.md
HKJC-YEAR-QUERY.doc.md
LOGS_PRO_FEATURES.doc.md
OFFICIAL_SOURCE_ARCHITECTURE.doc.md
ONCC-ADVANCED-SEARCH-ANALYSIS.doc.md
ONCC-HISTORY-SCRAPER-IMPLEMENTATION.doc.md
SNOWBALL-ANALYSIS-REPORT.doc.md
SNOWBALL-DISPLAY-SUMMARY.doc.md
SNOWBALL-IMPLEMENTATION-SUMMARY.doc.md
YEAR-QUERY-UPGRADE.doc.md
YEAR-RANGE-EXPANSION-SUMMARY.doc.md
```

**总结和测试文档** (16个):
```
DEEP-TEST-REPORT.doc.md
FINAL-SUMMARY.doc.md
FINAL_REPORT.doc.md
IMPLEMENTATION-SUMMARY-2025-12-28.doc.md
NEXT-STEPS.doc.md
PHASE-A-TEST-REPORT.doc.md
PHASE-B1-DARK-MODE-PLAN.doc.md
PLAN-A-INVESTIGATION-REPORT.doc.md
PLAN-A-QUICK-START.doc.md
PROJECT-SUMMARY.doc.md
SYSTEM_SUMMARY.doc.md
TEST-RESULT-SUMMARY.doc.md
TESTING-GUIDE.doc.md
URL-UPDATE-TO-ACTUAL.doc.md
USER-FEEDBACK.doc.md
WEB-ADMIN-GUIDE.doc.md
manual-test-checklist.doc.md
如何查看台湾彩票数据源.doc.md
```

**建议**: 将这81个.doc.md文件移动到 `docs/archive/` 目录

```bash
mkdir -p docs/archive
mv *.doc.md docs/archive/
```

#### 4. 中文Markdown文档 (13个) - 整理归档

**倒计时修复系列** (6个):
```
SG彩种倒计时修复方案.md
SG彩种倒计时最终方案.md
倒计时归零修复方案.md
前端倒计时本地计算方案.md
前端倒计时混合策略.md
极速彩WebSocket推送倒计时修复.md
极速彩倒计时归零修复方案.md
```

**最新文档** (7个) - 保留在根目录:
```
4000端口占用问题完整分析.md       # ✅ 保留
WSL重启倒计时问题解决方案.md       # ✅ 保留
前端构建与部署指南.md              # ✅ 保留
清理分析报告.md                    # ✅ 保留
清理完成报告.md                    # ✅ 保留
脚本修复完成报告.md                # ✅ 保留
根目录文件深度分析.md              # ✅ 保留（新建）
```

**建议**: 将倒计时修复系列移到 `docs/fixes/countdown/`

```bash
mkdir -p docs/fixes/countdown
mv *倒计时*.md SG彩种*.md docs/fixes/countdown/
```

#### 5. 临时文件和日志 (5个)

```bash
deep_test_results.log               # 测试结果日志
startup-test.log                    # 启动测试日志
wt.txt                              # 临时文本
clear-cache.html                    # 清缓存HTML
check_countdown.py                  # Python倒计时检查
```

**删除命令**:
```bash
rm -f *.log
rm -f wt.txt
rm -f clear-cache.html
rm -f check_countdown.py
```

### 二、需要保留的文件

#### 1. 核心配置文件 (10个)
```
package.json                        # ✅ npm配置
package-lock.json                   # ✅ 依赖锁定
docker-compose.yml                  # ✅ Docker编排
Dockerfile                          # ✅ Docker镜像
.gitignore                          # ✅ Git忽略
my.cnf                              # ✅ MySQL配置
alert-config.json                   # ✅ 告警配置
init.sql                            # ✅ 数据库初始化
create-completion-history-table.sql # ✅ 补全历史表
CLAUDE.md                           # ✅ Claude记忆文件
```

#### 2. 重要文档 (2个)
```
README.md                           # ✅ 项目说明
根目录深度清理方案.md               # ✅ 清理方案（新建）
```

#### 3. 启动脚本 (7个)
```
start.sh                            # ✅ 启动脚本
rebuild-and-restart.sh              # ✅ 重建并重启（已修复）
restart-as-root.sh                  # ✅ root重启（已修复）
restart-server.sh                   # ✅ 服务器重启（已修复）
restart-service.sh                  # ✅ 服务重启（已修复）
restart.sh                          # ✅ 基础重启（已修复）
restart_service.sh                  # ✅ 采集服务重启（已修复）
```

#### 4. 验证脚本 (3个) - 可选保留
```
verify-deployment.sh                # ✅ 部署验证
verify-dual-source.sh               # ✅ 双数据源验证
verify-hkjc-integration.sh          # ✅ HKJC集成验证
```

**建议**: 移到 `scripts/verification/`
```bash
mkdir -p scripts/verification
mv verify-*.sh scripts/verification/
```

#### 5. 重要测试脚本 (1个) - 可选保留
```
stress-test-websocket.js            # ⚠️ WebSocket压力测试（15K）
```

**建议**: 移到 `scripts/tests/`
```bash
mkdir -p scripts/tests
mv stress-test-websocket.js scripts/tests/
```

#### 6. 核心目录 (保留全部)
```
src/                                # ✅ 源代码
config/                             # ✅ 配置
data/                               # ✅ 数据
logs/                               # ✅ 日志
node_modules/                       # ✅ 依赖
tests/                              # ✅ 测试
scripts/                            # ✅ 脚本
migrations/                         # ✅ 迁移
schema/                             # ✅ 架构
sql/                                # ✅ SQL
docs/                               # ✅ 文档
tmp/                                # ⚠️ 临时文件（检查后清理内容）
```

### 三、清理执行计划

#### 阶段1: 删除测试和临时脚本（立即执行）

```bash
# 1. 删除测试脚本
rm -f test_*.js test_*.mjs test_*.py
rm -f check_*.js check_*.mjs
rm -f debug_*.js debug_*.mjs

# 2. 删除数据处理脚本
rm -f fetch-*.js
rm -f manual-*.js manual_*.mjs
rm -f verify-*.js verify_*.mjs verify_after_restart.sh
rm -f clean-*.js
rm -f compare_*.mjs
rm -f analyze_*.mjs
rm -f add-*.js
rm -f check-*.js
rm -f quick-test.js
rm -f create-history-table.js
rm -f 补填台湾彩票历史数据.js

# 3. 删除临时文件和日志
rm -f *.log
rm -f wt.txt
rm -f clear-cache.html
rm -f check_countdown.py
```

**预计删除**: 约50个文件

#### 阶段2: 整理文档文件（立即执行）

```bash
# 1. 创建归档目录
mkdir -p docs/archive
mkdir -p docs/fixes/countdown

# 2. 移动.doc.md文件到归档
mv *.doc.md docs/archive/

# 3. 移动倒计时修复文档
mv *倒计时*.md SG彩种*.md docs/fixes/countdown/ 2>/dev/null || true
```

**预计整理**: 约87个文档文件

#### 阶段3: 整理脚本文件（可选）

```bash
# 1. 创建脚本目录
mkdir -p scripts/verification
mkdir -p scripts/tests

# 2. 移动验证脚本
mv verify-deployment.sh verify-dual-source.sh verify-hkjc-integration.sh scripts/verification/

# 3. 移动测试脚本
mv stress-test-websocket.js scripts/tests/
```

### 四、清理后的目录结构

```
crawler-service/
├── package.json
├── package-lock.json
├── docker-compose.yml
├── Dockerfile
├── README.md
├── CLAUDE.md
├── .gitignore
├── my.cnf
├── alert-config.json
├── init.sql
├── create-completion-history-table.sql
├── start.sh
├── rebuild-and-restart.sh
├── restart-as-root.sh
├── restart-server.sh
├── restart-service.sh
├── restart.sh
├── restart_service.sh
├── 4000端口占用问题完整分析.md
├── WSL重启倒计时问题解决方案.md
├── 前端构建与部署指南.md
├── 清理分析报告.md
├── 清理完成报告.md
├── 脚本修复完成报告.md
├── 根目录深度清理方案.md
├── src/
├── config/
├── data/
├── logs/
├── node_modules/
├── tests/
├── scripts/
│   ├── verification/
│   │   ├── verify-deployment.sh
│   │   ├── verify-dual-source.sh
│   │   └── verify-hkjc-integration.sh
│   └── tests/
│       └── stress-test-websocket.js
├── migrations/
├── schema/
├── sql/
├── docs/
│   ├── archive/
│   │   └── (81个.doc.md文件)
│   └── fixes/
│       └── countdown/
│           └── (7个倒计时修复文档)
└── tmp/
```

### 五、清理效果预估

- **删除文件数**: 约50个脚本文件
- **归档文件数**: 约94个文档文件
- **移动文件数**: 4个脚本文件
- **保留根目录**: 约30个核心文件
- **节省空间**: 约200-300KB（脚本）
- **目录清晰度**: 从179个→30个文件

### 六、风险评估

- **风险等级**: 低
- **原因**:
  - 删除的都是临时测试脚本
  - 文档只是移动归档，不删除
  - 核心源代码和配置不受影响
  - 可从Git历史恢复

### 七、执行建议

1. **立即执行阶段1和阶段2** - 清理大部分杂乱文件
2. **可选执行阶段3** - 进一步整理脚本
3. **检查tmp目录** - 确认临时文件可以删除
4. **提交Git** - 清理后提交，便于回滚

---

**生成者**: Claude Code
**生成时间**: 2026-01-17 08:12
