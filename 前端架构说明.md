# å½©ç¥¨çˆ¬è™«ç³»ç»Ÿ - å‰ç«¯æ¶æ„è¯´æ˜

## ğŸ“‹ ç›®å½•

- [æŠ€æœ¯æ ˆ](#æŠ€æœ¯æ ˆ)
- [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„)
- [æ ¸å¿ƒç»„ä»¶](#æ ¸å¿ƒç»„ä»¶)
- [çŠ¶æ€ç®¡ç†](#çŠ¶æ€ç®¡ç†)
- [å®æ—¶é€šä¿¡](#å®æ—¶é€šä¿¡)
- [æ„å»ºéƒ¨ç½²](#æ„å»ºéƒ¨ç½²)
- [å¼€å‘è§„èŒƒ](#å¼€å‘è§„èŒƒ)

---

## æŠ€æœ¯æ ˆ

### æ ¸å¿ƒæ¡†æ¶

```json
{
  "framework": "Vue 3.3+",
  "composition-api": "setup + <script setup>",
  "ui-library": "Element Plus 2.4+",
  "build-tool": "Vite 5.0+",
  "router": "Vue Router 4.2+",
  "http-client": "axios 1.6+",
  "websocket": "åŸç”ŸWebSocket API",
  "package-manager": "npm"
}
```

### å¼€å‘å·¥å…·

- **ä»£ç è§„èŒƒ**: ESLint + Prettier
- **æ ·å¼é¢„å¤„ç†**: CSSï¼ˆElement Plusè‡ªå¸¦ä¸»é¢˜ï¼‰
- **å¼€å‘æœåŠ¡å™¨**: Vite Dev Server (HMRçƒ­æ›´æ–°)
- **æµè§ˆå™¨æ”¯æŒ**: Chrome 90+, Firefox 88+, Safari 14+

---

## é¡¹ç›®ç»“æ„

```
src/web/vue-app/
â”œâ”€â”€ public/                      # é™æ€èµ„æº
â”‚   â”œâ”€â”€ favicon.ico
â”‚   â””â”€â”€ index.html              # HTMLæ¨¡æ¿
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.js                 # åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ App.vue                 # æ ¹ç»„ä»¶
â”‚   â”‚
â”‚   â”œâ”€â”€ router/                 # è·¯ç”±é…ç½®
â”‚   â”‚   â””â”€â”€ index.js            # Vue Routeré…ç½®
â”‚   â”‚
â”‚   â”œâ”€â”€ services/               # ä¸šåŠ¡æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ api.js              # HTTP APIå°è£…
â”‚   â”‚   â””â”€â”€ websocket.js        # WebSocketæœåŠ¡
â”‚   â”‚
â”‚   â”œâ”€â”€ views/                  # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ RealtimeElementPlus.vue      # å®æ—¶å½©ç§é¡µé¢
â”‚   â”‚   â”œâ”€â”€ HistoryElementPlus.vue       # å†å²æ•°æ®é¡µé¢
â”‚   â”‚   â”œâ”€â”€ CrawlerLogsElementPlus.vue   # çˆ¬è™«æ—¥å¿—é¡µé¢
â”‚   â”‚   â”œâ”€â”€ AlertHistoryElementPlus.vue  # å‘Šè­¦å†å²é¡µé¢
â”‚   â”‚   â”œâ”€â”€ DomainHealthElementPlus.vue  # åŸŸåå¥åº·é¡µé¢
â”‚   â”‚   â”œâ”€â”€ DataCompletionElementPlus.vue # æ•°æ®è¡¥å…¨é¡µé¢
â”‚   â”‚   â”œâ”€â”€ SnowballEventsElementPlus.vue # é‡‘å¤šå®äº‹ä»¶é¡µé¢
â”‚   â”‚   â”œâ”€â”€ SystemSettingsElementPlus.vue # ç³»ç»Ÿè®¾ç½®é¡µé¢
â”‚   â”‚   â”œâ”€â”€ SystemLogsElementPlus.vue    # ç³»ç»Ÿæ—¥å¿—é¡µé¢
â”‚   â”‚   â”œâ”€â”€ SystemStatusElementPlus.vue  # ç³»ç»ŸçŠ¶æ€é¡µé¢
â”‚   â”‚   â””â”€â”€ HelpElementPlus.vue          # å¸®åŠ©æ–‡æ¡£é¡µé¢
â”‚   â”‚
â”‚   â”œâ”€â”€ components/             # é€šç”¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ CountdownDisplay.vue         # å€’è®¡æ—¶æ˜¾ç¤º
â”‚   â”‚   â”œâ”€â”€ LotteryCard.vue             # å½©ç§å¡ç‰‡
â”‚   â”‚   â”œâ”€â”€ AlertBadge.vue              # å‘Šè­¦å¾½ç« 
â”‚   â”‚   â””â”€â”€ DataTable.vue               # æ•°æ®è¡¨æ ¼
â”‚   â”‚
â”‚   â””â”€â”€ assets/                 # èµ„æºæ–‡ä»¶
â”‚       â”œâ”€â”€ styles/             # æ ·å¼æ–‡ä»¶
â”‚       â””â”€â”€ images/             # å›¾ç‰‡èµ„æº
â”‚
â”œâ”€â”€ dist/                       # âŒ æ„å»ºäº§ç‰©ï¼ˆè¾“å‡ºåˆ°../dist/ï¼‰
â”œâ”€â”€ vite.config.js              # Viteé…ç½®
â”œâ”€â”€ package.json                # é¡¹ç›®ä¾èµ–
â””â”€â”€ .eslintrc.js                # ESLinté…ç½®

# æ„å»ºäº§ç‰©è¾“å‡ºåˆ°ä¸Šçº§ç›®å½•
src/web/dist/                   # âœ… çœŸæ­£çš„æ„å»ºäº§ç‰©
â”œâ”€â”€ index.html
â”œâ”€â”€ assets/
â”‚   â”œâ”€â”€ js/
â”‚   â”‚   â”œâ”€â”€ main-[hash].js      # ä¸»åº”ç”¨ä»£ç 
â”‚   â”‚   â””â”€â”€ vendor-[hash].js    # ç¬¬ä¸‰æ–¹åº“
â”‚   â””â”€â”€ css/
â”‚       â””â”€â”€ main-[hash].css     # æ ·å¼æ–‡ä»¶
â””â”€â”€ favicon.ico
```

---

## æ ¸å¿ƒç»„ä»¶

### 1. å®æ—¶å½©ç§é¡µé¢ (RealtimeElementPlus.vue)

**åŠŸèƒ½**: å±•ç¤ºæ‰€æœ‰å½©ç§çš„å®æ—¶å¼€å¥–æ•°æ®å’Œå€’è®¡æ—¶

**æ ¸å¿ƒåŠŸèƒ½**:
- å½©ç§åˆ†ç±»æ˜¾ç¤ºï¼ˆé«˜é¢‘å½©/ä½é¢‘å½©ï¼‰
- å®æ—¶å€’è®¡æ—¶ï¼ˆWebSocket + æœ¬åœ°è®¡ç®—ï¼‰
- æœ€æ–°å¼€å¥–ç»“æœå±•ç¤º
- æ‰‹åŠ¨åˆ·æ–°åŠŸèƒ½
- WebSocketè¿æ¥çŠ¶æ€æŒ‡ç¤º

**å…³é”®ä»£ç **:
```vue
<script setup>
import { ref, onMounted, onUnmounted } from 'vue';
import { getLotteries, getLatestResult } from '@/services/api';
import { connectWebSocket, disconnectWebSocket } from '@/services/websocket';

const lotteries = ref([]);
const wsConnected = ref(false);

// åˆå§‹åŒ–åŠ è½½
onMounted(async () => {
  // 1. è·å–å½©ç§åˆ—è¡¨
  const response = await getLotteries();
  lotteries.value = response.data;

  // 2. è·å–æ¯ä¸ªå½©ç§çš„æœ€æ–°å¼€å¥–
  for (const lottery of lotteries.value) {
    const latest = await getLatestResult(lottery.lotCode);
    lottery.latestResult = latest.data;
    lottery.countdown = latest.data.countdown || 0;
  }

  // 3. å»ºç«‹WebSocketè¿æ¥
  connectWebSocket((message) => {
    handleWebSocketMessage(message);
  });

  // 4. å¯åŠ¨æœ¬åœ°å€’è®¡æ—¶
  startCountdown();
});

// WebSocketæ¶ˆæ¯å¤„ç†
function handleWebSocketMessage(message) {
  if (message.type === 'lottery_update') {
    const lottery = lotteries.value.find(l => l.lotCode === message.lotCode);
    if (lottery) {
      // æ›´æ–°æœŸå·å’Œå¼€å¥–å·ç 
      lottery.latestResult.issue = message.data.issue;
      lottery.latestResult.drawCode = message.data.drawCode;
      lottery.latestResult.drawTime = message.data.drawTime;

      // æ ¡å‡†å€’è®¡æ—¶
      lottery.countdown = message.data.countdown;
    }
  }
}

// æœ¬åœ°å€’è®¡æ—¶
function startCountdown() {
  setInterval(() => {
    lotteries.value.forEach(lottery => {
      if (lottery.countdown > 0) {
        lottery.countdown--;
      }
    });
  }, 1000);
}

// æ ¼å¼åŒ–å€’è®¡æ—¶æ˜¾ç¤º
function formatCountdown(seconds) {
  const hours = Math.floor(seconds / 3600);
  const minutes = Math.floor((seconds % 3600) / 60);
  const secs = seconds % 60;

  if (hours > 0) {
    return `${hours}å°æ—¶${minutes}åˆ†${secs}ç§’`;
  } else if (minutes > 0) {
    return `${minutes}åˆ†${secs}ç§’`;
  } else {
    return `${secs}ç§’`;
  }
}

// æ¸…ç†
onUnmounted(() => {
  disconnectWebSocket();
});
</script>

<template>
  <div class="realtime-page">
    <el-card>
      <template #header>
        <div class="header">
          <span>å®æ—¶å½©ç§</span>
          <el-tag :type="wsConnected ? 'success' : 'danger'">
            {{ wsConnected ? 'å·²è¿æ¥' : 'æœªè¿æ¥' }}
          </el-tag>
        </div>
      </template>

      <!-- é«˜é¢‘å½© -->
      <div class="lottery-section">
        <h3>é«˜é¢‘å½©ï¼ˆ5åˆ†é’Ÿ/æœŸï¼‰</h3>
        <el-row :gutter="20">
          <el-col
            v-for="lottery in lotteries.filter(l => l.category === 'high')"
            :key="lottery.lotCode"
            :span="8"
          >
            <lottery-card
              :lottery="lottery"
              :countdown="lottery.countdown"
              :latest-result="lottery.latestResult"
            />
          </el-col>
        </el-row>
      </div>

      <!-- ä½é¢‘å½© -->
      <div class="lottery-section">
        <h3>ä½é¢‘å½©ï¼ˆæ¯å¤©1-2æœŸï¼‰</h3>
        <el-row :gutter="20">
          <el-col
            v-for="lottery in lotteries.filter(l => l.category === 'low')"
            :key="lottery.lotCode"
            :span="8"
          >
            <lottery-card
              :lottery="lottery"
              :countdown="lottery.countdown"
              :latest-result="lottery.latestResult"
            />
          </el-col>
        </el-row>
      </div>
    </el-card>
  </div>
</template>
```

### 2. å†å²æ•°æ®é¡µé¢ (HistoryElementPlus.vue)

**åŠŸèƒ½**: æŸ¥è¯¢å’Œå±•ç¤ºå½©ç§çš„å†å²å¼€å¥–è®°å½•

**æ ¸å¿ƒåŠŸèƒ½**:
- å½©ç§é€‰æ‹©å™¨
- æ—¥æœŸèŒƒå›´é€‰æ‹©
- åˆ†é¡µæŸ¥è¯¢
- æ•°æ®å¯¼å‡ºï¼ˆCSV/Excelï¼‰
- é‡‘å¤šå®æ ‡è®°æ˜¾ç¤º

**å…³é”®ä»£ç **:
```vue
<script setup>
import { ref } from 'vue';
import { getHistory } from '@/services/api';
import { ElMessage } from 'element-plus';

const selectedLottery = ref('');
const selectedDate = ref(new Date());
const historyData = ref([]);
const loading = ref(false);
const pagination = ref({
  page: 1,
  limit: 50,
  total: 0
});

// æŸ¥è¯¢å†å²æ•°æ®
async function fetchHistory() {
  if (!selectedLottery.value) {
    ElMessage.warning('è¯·é€‰æ‹©å½©ç§');
    return;
  }

  loading.value = true;
  try {
    const response = await getHistory(
      selectedLottery.value,
      formatDate(selectedDate.value),
      pagination.value.page,
      pagination.value.limit
    );

    historyData.value = response.data.data;
    pagination.value.total = response.data.total;
  } catch (error) {
    ElMessage.error('æŸ¥è¯¢å¤±è´¥: ' + error.message);
  } finally {
    loading.value = false;
  }
}

// åˆ†é¡µå˜åŒ–
function handlePageChange(page) {
  pagination.value.page = page;
  fetchHistory();
}

// å¯¼å‡ºæ•°æ®
function exportData() {
  // å®ç°CSVå¯¼å‡ºé€»è¾‘
  const csv = convertToCSV(historyData.value);
  downloadFile(csv, `lottery_history_${selectedLottery.value}.csv`);
}
</script>

<template>
  <el-card>
    <template #header>
      <span>å†å²æ•°æ®æŸ¥è¯¢</span>
    </template>

    <!-- æŸ¥è¯¢æ¡ä»¶ -->
    <el-form inline>
      <el-form-item label="å½©ç§">
        <el-select v-model="selectedLottery" placeholder="è¯·é€‰æ‹©å½©ç§">
          <el-option
            v-for="lottery in lotteries"
            :key="lottery.lotCode"
            :label="lottery.lotName"
            :value="lottery.lotCode"
          />
        </el-select>
      </el-form-item>

      <el-form-item label="æ—¥æœŸ">
        <el-date-picker
          v-model="selectedDate"
          type="date"
          placeholder="é€‰æ‹©æ—¥æœŸ"
        />
      </el-form-item>

      <el-form-item>
        <el-button type="primary" @click="fetchHistory" :loading="loading">
          æŸ¥è¯¢
        </el-button>
        <el-button @click="exportData">å¯¼å‡º</el-button>
      </el-form-item>
    </el-form>

    <!-- æ•°æ®è¡¨æ ¼ -->
    <el-table :data="historyData" v-loading="loading">
      <el-table-column prop="issue" label="æœŸå·" width="150" />
      <el-table-column prop="drawCode" label="å¼€å¥–å·ç " width="300">
        <template #default="{ row }">
          <span class="draw-numbers">{{ row.drawCode }}</span>
          <el-tag v-if="row.snowballName" type="warning" size="small">
            {{ row.snowballName }}
          </el-tag>
        </template>
      </el-table-column>
      <el-table-column prop="drawTime" label="å¼€å¥–æ—¶é—´" width="180" />
      <el-table-column prop="createdAt" label="é‡‡é›†æ—¶é—´" width="180" />
    </el-table>

    <!-- åˆ†é¡µ -->
    <el-pagination
      v-model:current-page="pagination.page"
      :page-size="pagination.limit"
      :total="pagination.total"
      @current-change="handlePageChange"
      layout="total, prev, pager, next"
    />
  </el-card>
</template>
```

### 3. å‘Šè­¦å†å²é¡µé¢ (AlertHistoryElementPlus.vue)

**åŠŸèƒ½**: å±•ç¤ºç³»ç»Ÿå‘Šè­¦è®°å½•å’Œç»Ÿè®¡

**æ ¸å¿ƒåŠŸèƒ½**:
- å‘Šè­¦çº§åˆ«ç­›é€‰ï¼ˆcritical/error/warning/infoï¼‰
- å‘Šè­¦çŠ¶æ€ç­›é€‰ï¼ˆpending/resolved/ignoredï¼‰
- å‘Šè­¦ç»Ÿè®¡ï¼ˆä»Šæ—¥ç»Ÿè®¡ã€è§£å†³ç‡ï¼‰
- å‘Šè­¦å¤„ç†ï¼ˆæ ‡è®°è§£å†³ã€å¿½ç•¥ï¼‰

### 4. åŸŸåå¥åº·é¡µé¢ (DomainHealthElementPlus.vue)

**åŠŸèƒ½**: å±•ç¤ºåŸŸåå¥åº·çŠ¶æ€å’Œåˆ‡æ¢å†å²

**æ ¸å¿ƒåŠŸèƒ½**:
- åŸŸåçŠ¶æ€ç›‘æ§ï¼ˆactive/degraded/failed/disabledï¼‰
- å“åº”æ—¶é—´å›¾è¡¨
- æˆåŠŸç‡ç»Ÿè®¡
- æ‰‹åŠ¨åˆ‡æ¢åŸŸå
- åˆ‡æ¢å†å²è®°å½•

---

## çŠ¶æ€ç®¡ç†

### å…¨å±€çŠ¶æ€

ä½¿ç”¨ Vue 3 Composition API çš„ `ref` å’Œ `reactive` ç®¡ç†çŠ¶æ€ï¼Œæ— éœ€å¼•å…¥ Vuex/Piniaã€‚

**ç¤ºä¾‹**:
```javascript
// services/state.js
import { ref } from 'vue';

// å…¨å±€WebSocketè¿æ¥çŠ¶æ€
export const wsConnected = ref(false);

// å…¨å±€å½©ç§åˆ—è¡¨
export const lotteries = ref([]);

// å…¨å±€å‘Šè­¦ç»Ÿè®¡
export const alertStats = ref({
  total: 0,
  pending: 0,
  resolved: 0,
  criticalCount: 0,
  errorCount: 0,
  warningCount: 0
});
```

### ç»„ä»¶é—´é€šä¿¡

1. **Props / Emit**: çˆ¶å­ç»„ä»¶é€šä¿¡
2. **Provide / Inject**: è·¨å±‚çº§ç»„ä»¶é€šä¿¡
3. **Event Bus**: å…„å¼Ÿç»„ä»¶é€šä¿¡ï¼ˆå°‘ç”¨ï¼‰

---

## å®æ—¶é€šä¿¡

### WebSocketæœåŠ¡å°è£…

**æ–‡ä»¶**: `src/services/websocket.js`

```javascript
let ws = null;
let messageHandler = null;
let reconnectTimer = null;

// å»ºç«‹è¿æ¥
export function connectWebSocket(onMessage) {
  messageHandler = onMessage;

  const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
  const host = window.location.host;
  const wsUrl = `${protocol}//${host}`;

  ws = new WebSocket(wsUrl);

  ws.onopen = () => {
    console.log('[WebSocket] è¿æ¥æˆåŠŸ');
    wsConnected.value = true;

    // æ¸…é™¤é‡è¿å®šæ—¶å™¨
    if (reconnectTimer) {
      clearTimeout(reconnectTimer);
      reconnectTimer = null;
    }
  };

  ws.onmessage = (event) => {
    try {
      const message = JSON.parse(event.data);
      messageHandler(message);
    } catch (error) {
      console.error('[WebSocket] æ¶ˆæ¯è§£æå¤±è´¥:', error);
    }
  };

  ws.onerror = (error) => {
    console.error('[WebSocket] è¿æ¥é”™è¯¯:', error);
    wsConnected.value = false;
  };

  ws.onclose = () => {
    console.log('[WebSocket] è¿æ¥å…³é—­');
    wsConnected.value = false;

    // 5ç§’åè‡ªåŠ¨é‡è¿
    reconnectTimer = setTimeout(() => {
      console.log('[WebSocket] å°è¯•é‡è¿...');
      connectWebSocket(messageHandler);
    }, 5000);
  };
}

// æ–­å¼€è¿æ¥
export function disconnectWebSocket() {
  if (ws) {
    ws.close();
    ws = null;
  }

  if (reconnectTimer) {
    clearTimeout(reconnectTimer);
    reconnectTimer = null;
  }
}

// å‘é€æ¶ˆæ¯
export function sendMessage(message) {
  if (ws && ws.readyState === WebSocket.OPEN) {
    ws.send(JSON.stringify(message));
  } else {
    console.warn('[WebSocket] æœªè¿æ¥ï¼Œæ— æ³•å‘é€æ¶ˆæ¯');
  }
}
```

### WebSocketæ¶ˆæ¯æ ¼å¼

**æœåŠ¡å™¨æ¨é€**:
```javascript
{
  type: 'lottery_update',    // æ¶ˆæ¯ç±»å‹
  lotCode: '10001',          // å½©ç§ä»£ç 
  data: {
    issue: '2026011701',     // æœŸå·
    drawCode: '01,02,03',    // å¼€å¥–å·ç 
    drawTime: '2026-01-17 21:30:00',
    countdown: 278           // å€’è®¡æ—¶ï¼ˆç§’ï¼‰
  }
}
```

**å…¶ä»–æ¶ˆæ¯ç±»å‹**:
- `alert_new`: æ–°å‘Šè­¦é€šçŸ¥
- `domain_switch`: åŸŸååˆ‡æ¢é€šçŸ¥
- `system_status`: ç³»ç»ŸçŠ¶æ€æ›´æ–°

---

## HTTP APIå°è£…

**æ–‡ä»¶**: `src/services/api.js`

```javascript
import axios from 'axios';
import { ElMessage } from 'element-plus';

// åˆ›å»ºaxioså®ä¾‹
const api = axios.create({
  baseURL: '/api',
  timeout: 60000,  // 60ç§’è¶…æ—¶ï¼ˆå†å²æ•°æ®æŸ¥è¯¢å¯èƒ½è¾ƒæ…¢ï¼‰
  headers: {
    'Content-Type': 'application/json'
  }
});

// è¯·æ±‚æ‹¦æˆªå™¨
api.interceptors.request.use(
  (config) => {
    // å¯ä»¥åœ¨æ­¤æ·»åŠ tokenç­‰è®¤è¯ä¿¡æ¯
    return config;
  },
  (error) => {
    return Promise.reject(error);
  }
);

// å“åº”æ‹¦æˆªå™¨
api.interceptors.response.use(
  (response) => {
    return response.data;
  },
  (error) => {
    // ç»Ÿä¸€é”™è¯¯å¤„ç†
    if (error.code === 'ECONNABORTED') {
      ElMessage.error('è¯·æ±‚è¶…æ—¶ï¼Œè¯·ç¨åé‡è¯•');
    } else if (error.response) {
      const status = error.response.status;
      if (status === 404) {
        ElMessage.error('è¯·æ±‚çš„èµ„æºä¸å­˜åœ¨');
      } else if (status === 500) {
        ElMessage.error('æœåŠ¡å™¨é”™è¯¯ï¼Œè¯·è”ç³»ç®¡ç†å‘˜');
      } else {
        ElMessage.error(error.response.data.message || 'è¯·æ±‚å¤±è´¥');
      }
    } else {
      ElMessage.error('ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
    }

    return Promise.reject(error);
  }
);

// APIæ¥å£
export const getLotteries = () => api.get('/lotteries');
export const getLatestResult = (lotCode) => api.get(`/lottery/${lotCode}/latest`);
export const getHistory = (lotCode, date, page, limit) =>
  api.get(`/lottery/${lotCode}/history`, { params: { date, page, limit } });
export const getSystemStatus = () => api.get('/system/status');
export const getAlertHistory = (params) => api.get('/alerts/history', { params });
export const getDomainHealth = () => api.get('/domains/health');

export default api;
```

---

## æ„å»ºéƒ¨ç½²

### Viteé…ç½®

**æ–‡ä»¶**: `vite.config.js`

```javascript
import { defineConfig } from 'vite';
import vue from '@vitejs/plugin-vue';
import path from 'path';

export default defineConfig({
  plugins: [vue()],

  // è·¯å¾„åˆ«å
  resolve: {
    alias: {
      '@': path.resolve(__dirname, 'src')
    }
  },

  // æ„å»ºé…ç½®
  build: {
    outDir: '../dist',           // è¾“å‡ºåˆ°ä¸Šçº§distç›®å½•
    assetsDir: 'assets',         // èµ„æºæ–‡ä»¶ç›®å½•
    sourcemap: false,            // ç”Ÿäº§ç¯å¢ƒä¸ç”Ÿæˆsourcemap
    minify: 'terser',            // ä½¿ç”¨terserå‹ç¼©
    chunkSizeWarningLimit: 1000, // chunkå¤§å°è­¦å‘Šé˜ˆå€¼

    rollupOptions: {
      output: {
        // ä»£ç åˆ†å‰²
        manualChunks: {
          'element-plus': ['element-plus'],
          'vue': ['vue', 'vue-router'],
          'axios': ['axios']
        }
      }
    }
  },

  // å¼€å‘æœåŠ¡å™¨
  server: {
    port: 4001,              // å¼€å‘æœåŠ¡å™¨ç«¯å£
    proxy: {
      '/api': {
        target: 'http://localhost:4000',  // ä»£ç†åˆ°åç«¯
        changeOrigin: true
      },
      '/ws': {
        target: 'ws://localhost:4000',
        ws: true
      }
    }
  }
});
```

### æ„å»ºå‘½ä»¤

```bash
# å¼€å‘æ¨¡å¼ï¼ˆçƒ­æ›´æ–°ï¼‰
npm run dev

# ç”Ÿäº§æ„å»º
npm run build

# é¢„è§ˆæ„å»ºäº§ç‰©
npm run preview
```

### æ„å»ºæµç¨‹

```
æºä»£ç 
  â†“
Viteç¼–è¯‘
  â†“
ä»£ç åˆ†å‰²
  â”œâ”€ main-[hash].js      (ä¸»åº”ç”¨ä»£ç )
  â”œâ”€ element-plus-[hash].js (Element Plus)
  â”œâ”€ vue-[hash].js       (Vueæ¡†æ¶)
  â””â”€ axios-[hash].js     (HTTPå®¢æˆ·ç«¯)
  â†“
å‹ç¼©ä¼˜åŒ–
  â†“
è¾“å‡ºåˆ° src/web/dist/
  â†“
WebServer.js é™æ€æ–‡ä»¶æœåŠ¡
```

### éƒ¨ç½²æ³¨æ„äº‹é¡¹

1. **æ¯æ¬¡ä¿®æ”¹å‰ç«¯ä»£ç åå¿…é¡»é‡æ–°æ„å»º**

```bash
cd src/web/vue-app
npm run build
```

2. **æ„å»ºäº§ç‰©ä½ç½®**: `src/web/dist/`ï¼ˆä¸æ˜¯ `vue-app/dist/`ï¼‰

3. **WebServerä½¿ç”¨çš„æ˜¯æ„å»ºäº§ç‰©**ï¼Œä¸æ˜¯æºç 

4. **Dockeréƒ¨ç½²**:
```dockerfile
# Dockerfile
FROM node:18-alpine
WORKDIR /app

# å®‰è£…ä¾èµ–
COPY package*.json ./
RUN npm install --production

# å¤åˆ¶æºç 
COPY . .

# æ„å»ºå‰ç«¯
WORKDIR /app/src/web/vue-app
RUN npm install && npm run build

# è¿”å›æ ¹ç›®å½•
WORKDIR /app

# å¯åŠ¨æœåŠ¡
CMD ["node", "src/index.js"]
```

---

## å¼€å‘è§„èŒƒ

### 1. ç»„ä»¶å‘½å

- **é¡µé¢ç»„ä»¶**: `PascalCase` + `ElementPlus` åç¼€
  - ä¾‹å¦‚: `RealtimeElementPlus.vue`
- **é€šç”¨ç»„ä»¶**: `PascalCase`
  - ä¾‹å¦‚: `CountdownDisplay.vue`

### 2. ä»£ç é£æ ¼

**Vue 3 Composition API + `<script setup>`**:

```vue
<script setup>
import { ref, computed, onMounted } from 'vue';

// Propså®šä¹‰
const props = defineProps({
  lottery: Object,
  countdown: Number
});

// Emitså®šä¹‰
const emit = defineEmits(['refresh', 'update']);

// å“åº”å¼æ•°æ®
const loading = ref(false);

// è®¡ç®—å±æ€§
const formattedCountdown = computed(() => {
  return formatTime(props.countdown);
});

// æ–¹æ³•
function handleRefresh() {
  emit('refresh');
}

// ç”Ÿå‘½å‘¨æœŸ
onMounted(() => {
  console.log('ç»„ä»¶å·²æŒ‚è½½');
});
</script>

<template>
  <div class="component">
    <!-- æ¨¡æ¿å†…å®¹ -->
  </div>
</template>

<style scoped>
.component {
  /* æ ·å¼ */
}
</style>
```

### 3. å¼‚æ­¥å¤„ç†

**ä½¿ç”¨ async/await**:

```javascript
async function fetchData() {
  loading.value = true;
  try {
    const response = await api.get('/data');
    data.value = response.data;
  } catch (error) {
    ElMessage.error('åŠ è½½å¤±è´¥: ' + error.message);
  } finally {
    loading.value = false;
  }
}
```

### 4. é”™è¯¯å¤„ç†

**ç»Ÿä¸€é”™è¯¯æç¤º**:

```javascript
import { ElMessage, ElMessageBox } from 'element-plus';

// æˆåŠŸæç¤º
ElMessage.success('æ“ä½œæˆåŠŸ');

// è­¦å‘Šæç¤º
ElMessage.warning('è¯·å…ˆé€‰æ‹©å½©ç§');

// é”™è¯¯æç¤º
ElMessage.error('ç½‘ç»œé”™è¯¯ï¼Œè¯·é‡è¯•');

// ç¡®è®¤å¯¹è¯æ¡†
ElMessageBox.confirm('ç¡®å®šè¦åˆ é™¤å—ï¼Ÿ', 'æç¤º', {
  confirmButtonText: 'ç¡®å®š',
  cancelButtonText: 'å–æ¶ˆ',
  type: 'warning'
}).then(() => {
  // ç¡®è®¤æ“ä½œ
}).catch(() => {
  // å–æ¶ˆæ“ä½œ
});
```

### 5. æ€§èƒ½ä¼˜åŒ–

**é¿å…ä¸å¿…è¦çš„æ¸²æŸ“**:

```vue
<script setup>
import { ref, computed, watch } from 'vue';

// ä½¿ç”¨computedç¼“å­˜è®¡ç®—ç»“æœ
const filteredData = computed(() => {
  return data.value.filter(item => item.status === 'active');
});

// ä½¿ç”¨watchç›‘å¬ç‰¹å®šå˜åŒ–
watch(() => props.lottery, (newVal) => {
  fetchLatestResult(newVal.lotCode);
}, { immediate: true });
</script>
```

**åˆ—è¡¨æ¸²æŸ“ä¼˜åŒ–**:

```vue
<template>
  <!-- ä½¿ç”¨keyä¼˜åŒ–åˆ—è¡¨æ¸²æŸ“ -->
  <div v-for="lottery in lotteries" :key="lottery.lotCode">
    {{ lottery.lotName }}
  </div>

  <!-- è™šæ‹Ÿæ»šåŠ¨ï¼ˆå¤§æ•°æ®é‡ï¼‰ -->
  <el-table
    :data="tableData"
    :virtual="true"
    :height="600"
  />
</template>
```

---

## å¸¸è§é—®é¢˜

### Q1: å‰ç«¯ä¿®æ”¹åä¸ç”Ÿæ•ˆï¼Ÿ

**åŸå› **: æœªé‡æ–°æ„å»ºæˆ–æµè§ˆå™¨ç¼“å­˜

**è§£å†³**:
```bash
# 1. é‡æ–°æ„å»º
cd src/web/vue-app
npm run build

# 2. é‡å¯æœåŠ¡
cd ../../..
docker-compose restart lottery-crawler

# 3. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
Ctrl + Shift + Rï¼ˆç¡¬åˆ·æ–°ï¼‰
```

### Q2: WebSocketè¿æ¥å¤±è´¥ï¼Ÿ

**æ’æŸ¥**:
1. æ£€æŸ¥åç«¯WebSocketæœåŠ¡æ˜¯å¦å¯åŠ¨
2. æ£€æŸ¥é˜²ç«å¢™æ˜¯å¦é˜»æ­¢WebSocketè¿æ¥
3. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯ä¿¡æ¯

### Q3: å€’è®¡æ—¶ä¸å‡†ç¡®ï¼Ÿ

**åŸå› **: WebSocketæ¨é€å»¶è¿Ÿæˆ–æœ¬åœ°è®¡ç®—è¯¯å·®

**è§£å†³**: ä½¿ç”¨æ··åˆç­–ç•¥ï¼ˆWebSocketæ¨é€ + æœ¬åœ°è®¡ç®— + å®šæœŸæ ¡å‡†ï¼‰

### Q4: Element Plusæ ·å¼å¼‚å¸¸ï¼Ÿ

**åŸå› **: CSSåŠ è½½é¡ºåºæˆ–è¦†ç›–é—®é¢˜

**è§£å†³**:
```javascript
// main.js ä¸­æ­£ç¡®å¯¼å…¥Element Plusæ ·å¼
import 'element-plus/dist/index.css';
```

---

## ç›¸å…³æ–‡æ¡£

- [éƒ¨ç½²æŒ‡å—.md](./éƒ¨ç½²æŒ‡å—.md) - éƒ¨ç½²å’Œè¿ç»´
- [é¡¹ç›®æ¶æ„è¯´æ˜.md](./é¡¹ç›®æ¶æ„è¯´æ˜.md) - åç«¯æ¶æ„
- [å‰ç«¯æ„å»ºä¸éƒ¨ç½²æŒ‡å—.md](./å‰ç«¯æ„å»ºä¸éƒ¨ç½²æŒ‡å—.md) - å‰ç«¯å¼€å‘æµç¨‹
- [Element Pluså®˜æ–¹æ–‡æ¡£](https://element-plus.org/)
- [Vue 3å®˜æ–¹æ–‡æ¡£](https://cn.vuejs.org/)
- [Viteå®˜æ–¹æ–‡æ¡£](https://cn.vitejs.dev/)
